<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>RSpec Matchers | IamRubyist</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="RSpec是Ruby世界所熟知的测试框架，它可以用于单元测试及功能测试（与Cucumber配合）。与其他测试框架一样，完成测试功能、实现红绿循环的核心是断言语句，而RSpec的断言是通过{}.should、expect{...}.to+Matcher实现的。下面就总结一下RSpec内建的Matcher以及如何定制自己的Matcher。 ##内建Matcher ###include 数组中是否包含某">
<meta name="keywords" content="ruby,rspec">
<meta property="og:type" content="article">
<meta property="og:title" content="RSpec Matchers">
<meta property="og:url" content="http://justinfeng.github.io/2012/10/29/rspec-matchers/index.html">
<meta property="og:site_name" content="IamRubyist">
<meta property="og:description" content="RSpec是Ruby世界所熟知的测试框架，它可以用于单元测试及功能测试（与Cucumber配合）。与其他测试框架一样，完成测试功能、实现红绿循环的核心是断言语句，而RSpec的断言是通过{}.should、expect{...}.to+Matcher实现的。下面就总结一下RSpec内建的Matcher以及如何定制自己的Matcher。 ##内建Matcher ###include 数组中是否包含某">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-07-14T01:53:08.912Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RSpec Matchers">
<meta name="twitter:description" content="RSpec是Ruby世界所熟知的测试框架，它可以用于单元测试及功能测试（与Cucumber配合）。与其他测试框架一样，完成测试功能、实现红绿循环的核心是断言语句，而RSpec的断言是通过{}.should、expect{...}.to+Matcher实现的。下面就总结一下RSpec内建的Matcher以及如何定制自己的Matcher。 ##内建Matcher ###include 数组中是否包含某">
  
    <link rel="alternate" href="/atom.xml" title="IamRubyist" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">IamRubyist</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://justinfeng.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-rspec-matchers" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/10/29/rspec-matchers/" class="article-date">
  <time datetime="2012-10-29T10:09:00.000Z" itemprop="datePublished">2012-10-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      RSpec Matchers
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>RSpec是Ruby世界所熟知的测试框架，它可以用于<strong>单元测试</strong>及<strong>功能测试</strong>（与Cucumber配合）。与其他测试框架一样，完成测试功能、实现红绿循环的核心是断言语句，而RSpec的断言是通过<code>{}.should</code>、<code>expect{...}.to</code>+Matcher实现的。下面就总结一下RSpec内建的Matcher以及如何定制自己的Matcher。</p>
<p>##内建Matcher</p>
<p>###include</p>
<p>数组中是否包含某元素<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">milan_players.should <span class="keyword">include</span>(<span class="string">'Maldini'</span>)</span><br></pre></td></tr></table></figure></p>
<p>###respond_to</p>
<p>对象是否有某个方法<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'Milan'</span>.should respond_to(<span class="symbol">:length</span>)</span><br></pre></td></tr></table></figure></p>
<p>###raise_error, throw_symbol</p>
<p>代码执行时是否抛出异常，如果不传参数则验证任意异常的抛出；如果给一个参数，可以是某个具体的异常类或者异常描述（支持正则匹配）；当然也可以给两个参数，第一个为异常类，第二个为异常描述<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lambda &#123; Object.new.explode! &#125;.should raise_error(NameError)</span><br></pre></td></tr></table></figure></p>
<p>###==, ===, equal, eql</p>
<p>上述几个Matcher用于测试相等，其效果与Ruby中对应的操作符或方法相同<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">3</span> * <span class="number">5</span>).should == <span class="number">15</span></span><br></pre></td></tr></table></figure></p>
<p>注意：RSpec不建议使用<code>!=</code>，可以用<code>should_not ==</code>代替</p>
<p>###be_close</p>
<p>可以用来测试浮点型数据是否相差在某个误差内<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result.should be_close(<span class="number">5.25</span>, <span class="number">0</span>.<span class="number">005</span>)</span><br></pre></td></tr></table></figure></p>
<p>###match, =~</p>
<p>验证正则表达式匹配<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result.should =~ <span class="regexp">/this expression/</span></span><br></pre></td></tr></table></figure></p>
<p>###change</p>
<p>判断数值变化，相关使用方法非常接近自然语言，不多做解释，看例子<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">expect &#123;</span><br><span class="line">  User.create!(<span class="symbol">:role</span> =&gt; <span class="string">"admin"</span>)</span><br><span class="line">&#125;.to change&#123; User.admins.count &#125;</span><br><span class="line"></span><br><span class="line">expect &#123;</span><br><span class="line">  User.create!(<span class="symbol">:role</span> =&gt; <span class="string">"admin"</span>)</span><br><span class="line">&#125;.to change&#123; User.admins.count &#125;.by(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">expect &#123;</span><br><span class="line">  User.create!(<span class="symbol">:role</span> =&gt; <span class="string">"admin"</span>)</span><br><span class="line">&#125;.to change&#123; User.admins.count &#125;.to(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">expect &#123;</span><br><span class="line">  User.create!(<span class="symbol">:role</span> =&gt; <span class="string">"admin"</span>)</span><br><span class="line">&#125;.to change&#123; User.admins.count &#125;.from(<span class="number">0</span>).to(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<p>###布尔Matcher</p>
<p>当一个对象中有布尔方法<code>XXX?</code>，则RSpec会自动为其生成如下的几个Matcher</p>
<pre><code>be_XXX
be_a_XXX
be_an_XXX
</code></pre><p>###be_true(false)</p>
<p>用来断言真假时，还可以直接使用如下的Matcher</p>
<pre><code>be_true
be_false
</code></pre><p>###have开头的布尔Matcher</p>
<p>当一个对象中有<code>has_XXX?</code>方法时，RSpec会为其自动生成<code>have_XXX</code>的Matcher<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request_parameters.should have_key(<span class="symbol">:id</span>)</span><br></pre></td></tr></table></figure></p>
<p>补充：为了使断言语句更加接近自然语言，如果在Matcher上调用不存在的方法，该方法会被代理到Matcher所传给的目标对象，漂亮的语法糖<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">home_team.should have(<span class="number">9</span>).players_on(field)</span><br></pre></td></tr></table></figure></p>
<p>###集合Matcher</p>
<p>对于集合对象来说，还有几个内建的Matcher非常直观和实用<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">day.should have_exactly(<span class="number">24</span>).hours</span><br><span class="line">dozen_bagels.should have_at_least(<span class="number">12</span>).bagels</span><br><span class="line">internet.should have_at_most(<span class="number">2037</span>).killer_social_networking_apps</span><br></pre></td></tr></table></figure></p>
<p>###运算符Matcher</p>
<p>处理前面提到的一些运算符Matcher之外，常用的还有<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">result.should be &lt; <span class="number">7</span></span><br><span class="line">result.should be &lt;= <span class="number">7</span></span><br><span class="line">result.should be &gt;= <span class="number">7</span></span><br><span class="line">result.should be &gt; <span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<p>##定制Matcher</p>
<p>如果RSpec内建提供的Matcher不能满足需求，你还可以自己定制专用的Matcher，具体的定义方法如下<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">RSpec::Matcher.define <span class="symbol">:report_to</span> <span class="keyword">do</span> <span class="params">|boss|</span></span><br><span class="line">  match <span class="keyword">do</span> <span class="params">|employee|</span></span><br><span class="line">    employee.reports_to?(boss)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  failure_message_for_should <span class="keyword">do</span> <span class="params">|employee|</span></span><br><span class="line">    <span class="string">"expected the team run by <span class="subst">#&#123;boss&#125;</span>"</span> to <span class="keyword">include</span> <span class="comment">#&#123;employee&#125;"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  failure_message_for_should_not <span class="keyword">do</span> <span class="params">|employee|</span></span><br><span class="line">    <span class="string">"expected the team run by <span class="subst">#&#123;boss&#125;</span>"</span> to exclude <span class="comment">#&#123;employee&#125;"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  description <span class="keyword">do</span></span><br><span class="line">    <span class="string">"expected a member of the team run by <span class="subst">#&#123;boss&#125;</span>"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>上面代码中给出了定义一个Matcher较为完整的方式，定义中的4个块传递并不都是必须的，要完成一个Matcher的定义必须提供的内容为<code>match</code>块和<code>failure_message_for_should</code>块，另外两个块是可选的。</p>
<p>掌握了自定义Matcher的方法，相信从技术上应该没有什么断言语句是你写不出来的喽：）    </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://justinfeng.github.io/2012/10/29/rspec-matchers/" data-id="cjjkthuwh00048vtn1iqkyhyi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rspec/">rspec</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">ruby</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2013/04/25/image-overlap-in-email/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Image Overlap in Email
        
      </div>
    </a>
  
  
    <a href="/2012/09/22/ruby-class-secret-2/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Ruby Class Secret(Part II)</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/email/">email</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geolocation/">geolocation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/">html5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rspec/">rspec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/">ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-server/">web server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-worker/">web_worker</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/email/" style="font-size: 10px;">email</a> <a href="/tags/geolocation/" style="font-size: 10px;">geolocation</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/html5/" style="font-size: 15px;">html5</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/rspec/" style="font-size: 10px;">rspec</a> <a href="/tags/ruby/" style="font-size: 20px;">ruby</a> <a href="/tags/web-server/" style="font-size: 10px;">web server</a> <a href="/tags/web-worker/" style="font-size: 10px;">web_worker</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/06/21/goliath-non-blocking-ruby-web-server-framework/">Goliath - Non Blocking Ruby Web Server Framework</a>
          </li>
        
          <li>
            <a href="/2015/05/06/html5-geolocation-in-china/">HTML5 Geolocation in China</a>
          </li>
        
          <li>
            <a href="/2015/04/05/html5-web-worker/">HTML5 - Web Worker</a>
          </li>
        
          <li>
            <a href="/2013/04/25/image-overlap-in-email/">Image Overlap in Email</a>
          </li>
        
          <li>
            <a href="/2012/10/29/rspec-matchers/">RSpec Matchers</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Justin Feng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>